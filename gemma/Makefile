# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Mon Apr 29 11:01:43 CDT 2019               #
###########################################################

DISTNAME=	GEMMA-0.98.1
CATEGORIES=	biology
MASTER_SITES=	${MASTER_SITE_GITHUB:=genetics-statistics/}
GITHUB_PROJECT=	GEMMA

MAINTAINER=	bacon@NetBSD.org
HOMEPAGE=	https://github.com/genetics-statistics/GEMMA
COMMENT=	Genome-wide Efficient Mixed Model Association
LICENSE=	gnu-gpl-v3

USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake perl

CXXFLAGS+=	-I${PREFIX}/include/eigen3
CXXFLAGS+=	-fpermissive
MAKE_FLAGS+=	LDFLAGS+="${LAPACK_LIBS} -lgsl -lcblas -lz"
MAKE_FILE=	${FILESDIR}/Makefile

# Requires multithreading for decent performance
BLAS_ACCEPTED=	openblas_pthread openblas_openmp

.include "../../wip/mk/blas.buildlink3.mk"

.if !empty(BLAS_TYPE:Mopenblas*)
CXXFLAGS+=	-I${PREFIX}/include/${BLAS_TYPE} -DOPENBLAS
.endif

# No multithreading
.if ${BLAS_TYPE} == "openblas"
CXXFLAGS+=	-DOPENBLAS_LEGACY
.endif

INSTALLATION_DIRS=	bin share/examples

do-test:
	(cd ${WRKSRC}/test && ${SH} test_suite.sh)

.include "../../devel/zlib/buildlink3.mk"
.include "../../wip/cblas/buildlink3.mk"
.include "../../math/gsl/buildlink3.mk"
.include "../../math/eigen3/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
